{% extends "base.html" %}
{% load static %}

{% block title %}Daftar Supplier{% endblock %}
{% block page_title %}Daftar Supplier{% endblock %}

{% block content %}
<!-- Modal for Adding Supplier -->
<div class="modal fade" id="tambahSupplierModal" tabindex="-1" aria-labelledby="tambahSupplierModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <form method="post" action="{% url 'tambah_supplier' %}">
                {% csrf_token %}
                <div class="modal-header">
                    <h5 class="modal-title" id="tambahSupplierModalLabel"><i class="fas fa-plus"></i> Tambah Supplier</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>

                <div class="modal-body">
                    <div class="mb-3">
                        <label for="{{ formSupplier.nama.id_for_label }}" class="form-label">{{ formSupplier.nama.label }}</label>
                        {{ formSupplier.nama }}
                        {% if formSupplier.nama.errors %}
                            <div class="text-danger">{{ formSupplier.nama.errors|striptags }}</div>
                        {% endif %}
                    </div>

                    <div class="mb-3">
                        <label for="{{ formSupplier.kontak.id_for_label }}" class="form-label">{{ formSupplier.kontak.label }}</label>
                        {{ formSupplier.kontak }}
                        {% if formSupplier.kontak.errors %}
                            <div class="text-danger">{{ formSupplier.kontak.errors|striptags }}</div>
                        {% endif %}
                    </div>

                    <div class="mb-3">
                        <label for="{{ formSupplier.alamat.id_for_label }}" class="form-label">{{ formSupplier.alamat.label }}</label>
                        {{ formSupplier.alamat }}
                        {% if formSupplier.alamat.errors %}
                            <div class="text-danger">{{ formSupplier.alamat.errors|striptags }}</div>
                        {% endif %}
                    </div>

                    <div class="mb-3">
                        <label for="{{ formSupplier.email.id_for_label }}" class="form-label">{{ formSupplier.email.label }}</label>
                        {{ formSupplier.email }}
                        {% if formSupplier.email.errors %}
                            <div class="text-danger">{{ formSupplier.email.errors|striptags }}</div>
                        {% endif %}
                    </div>

                    <div class="mb-3 form-check">
                        {{ formSupplier.aktif }}
                        <label for="{{ formSupplier.aktif.id_for_label }}" class="form-check-label">{{ formSupplier.aktif.label }}</label>
                        {% if formSupplier.aktif.errors %}
                            <div class="text-danger">{{ formSupplier.aktif.errors|striptags }}</div>
                        {% endif %}
                    </div>
                </div>

                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Batal</button>
                    <button type="submit" class="btn btn-success">Simpan</button>
                </div>
            </form>
        </div>
    </div>
</div>
<!-- Modal Edit Supplier -->
<div class="modal fade" id="editSupplierModal" tabindex="-1" aria-labelledby="editSupplierModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <form id="formEditSupplier" method="post">
                {% csrf_token %}
                <input type="hidden" id="edit_supplier_id" name="supplier_id">
                
                <div class="modal-header bg-warning text-white">
                    <h5 class="modal-title" id="editSupplierModalLabel">
                        <i class="fas fa-edit"></i> Edit Supplier
                    </h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                
                <div class="modal-body">
                    <div class="mb-3">
                        <label for="edit_nama" class="form-label">Nama Supplier</label>
                        <input type="text" class="form-control" id="edit_nama" name="nama" required>
                        <div class="invalid-feedback" id="error_nama"></div>
                    </div>
                    
                    <div class="mb-3">
                        <label for="edit_kontak" class="form-label">Kontak Supplier</label>
                        <input type="text" class="form-control" id="edit_kontak" name="kontak" required>
                        <div class="invalid-feedback" id="error_kontak"></div>
                    </div>
                    
                    <div class="mb-3">
                        <label for="edit_alamat" class="form-label">Alamat Supplier</label>
                        <textarea class="form-control" id="edit_alamat" name="alamat" rows="3"></textarea>
                        <div class="invalid-feedback" id="error_alamat"></div>
                    </div>
                    
                    <div class="mb-3">
                        <label for="edit_email" class="form-label">Email Supplier</label>
                        <input type="email" class="form-control" id="edit_email" name="email" required>
                        <div class="invalid-feedback" id="error_email"></div>
                    </div>
                    
                    <div class="mb-3 form-check form-switch">
                        <input class="form-check-input" type="checkbox" id="edit_aktif" name="aktif">
                        <label class="form-check-label" for="edit_aktif">Status Aktif</label>
                        <div class="invalid-feedback" id="error_aktif"></div>
                    </div>
                </div>
                
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
                        <i class="fas fa-times"></i> Batal
                    </button>
                    <button type="submit" class="btn btn-warning">
                        <i class="fas fa-save"></i> Simpan Perubahan
                    </button>
                </div>
            </form>
        </div>
    </div>
</div>

<!-- Modal for Adding Gudang -->
<div class="modal fade" id="tambahGudangModal" tabindex="-1" aria-labelledby="tambahGudangModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <form method="post" action="{% url 'tambah_gudang' %}">
                {% csrf_token %}
                <div class="modal-header">
                    <h5 class="modal-title" id="tambahGudangModalLabel"><i class="fas fa-plus"></i> Tambah Gudang</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>

                <div class="modal-body">
                    <div class="mb-3">
                        <label for="{{ formGudang.nama.id_for_label }}" class="form-label">{{ formGudang.nama.label }}</label>
                        {{ formGudang.nama }}
                        {% if formGudang.nama.errors %}
                            <div class="text-danger">{{ formGudang.nama.errors|striptags }}</div>
                        {% endif %}
                    </div>

                    <div class="mb-3">
                        <label for="{{ formGudang.lokasi.id_for_label }}" class="form-label">{{ formGudang.lokasi.label }}</label>
                        {{ formGudang.lokasi }}
                        {% if formGudang.lokasi.errors %}
                            <div class="text-danger">{{ formGudang.lokasi.errors|striptags }}</div>
                        {% endif %}
                    </div>

                    <div class="mb-3">
                        <label for="{{ formGudang.penanggung_jawab.id_for_label }}" class="form-label">{{ formGudang.penanggung_jawab.label }}</label>
                        {{ formGudang.penanggung_jawab }}
                        {% if formGudang.penanggung_jawab.errors %}
                            <div class="text-danger">{{ formGudang.penanggung_jawab.errors|striptags }}</div>
                        {% endif %}
                    </div>

                    <div class="mb-3">
                        <label for="{{ formGudang.kapasitas.id_for_label }}" class="form-label">{{ formGudang.kapasitas.label }}</label>
                        {{ formGudang.kapasitas }}
                        {% if formGudang.kapasitas.errors %}
                            <div class="text-danger">{{ formGudang.kapasitas.errors|striptags }}</div>
                        {% endif %}
                    </div>

                    <div class="mb-3 form-check">
                        {{ formGudang.aktif }}
                        <label for="{{ formGudang.aktif.id_for_label }}" class="form-check-label">{{ formGudang.aktif.label }}</label>
                        {% if formGudang.aktif.errors %}
                            <div class="text-danger">{{ formGudang.aktif.errors|striptags }}</div>
                        {% endif %}
                    </div>
                </div>

                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Batal</button>
                    <button type="submit" class="btn btn-success">Simpan</button>
                </div>
            </form>
        </div>
    </div>
</div>
<!-- Modal Edit Gudang -->
<div class="modal fade" id="editGudangModal" tabindex="-1" aria-labelledby="editGudangModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <form id="formEditGudang" method="post">
                {% csrf_token %}
                <input type="hidden" id="edit_gudang_id" name="gudang_id">
                
                <div class="modal-header bg-warning text-white">
                    <h5 class="modal-title" id="editGudangModalLabel">
                        <i class="fas fa-edit"></i> Edit Gudang
                    </h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                
                <div class="modal-body">
                    <div class="mb-3">
                        <label for="edit_nama" class="form-label">Nama Gudang</label>
                        <input type="text" class="form-control" id="edit_nama" name="nama" required>
                        <div class="invalid-feedback" id="error_nama"></div>
                    </div>
                    
                    <div class="mb-3">
                        <label for="edit_lokasi" class="form-label">Lokasi Gudang</label>
                        <textarea class="form-control" id="edit_lokasi" name="lokasi" rows="3"></textarea>
                        <div class="invalid-feedback" id="error_lokasi"></div>
                    </div>
                    
                    <div class="mb-3">
                        <label for="edit_penanggung_jawab" class="form-label">Penanggung Jawab</label>
                        <input type="text" class="form-control" id="edit_penanggung_jawab" name="penanggung_jawab" required>
                        <div class="invalid-feedback" id="error_penanggung_jawab"></div>
                    </div>
                    
                    <div class="mb-3">
                        <label for="edit_kapasitas" class="form-label">Kapasitas Gudang</label>
                        <input type="number" class="form-control" id="edit_kapasitas" name="kapasitas" required>
                        <div class="invalid-feedback" id="error_kapasitas"></div>
                    </div>
                    
                    <div class="mb-3 form-check form-switch">
                        <input class="form-check-input" type="checkbox" id="edit_aktif" name="aktif">
                        <label class="form-check-label" for="edit_aktif">Status Aktif</label>
                        <div class="invalid-feedback" id="error_aktif"></div>
                    </div>
                </div>
                
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
                        <i class="fas fa-times"></i> Batal
                    </button>
                    <button type="submit" class="btn btn-warning">
                        <i class="fas fa-save"></i> Simpan Perubahan
                    </button>
                </div>
            </form>
        </div>
    </div>
</div>

<!-- Modal for Adding Retur Penjualan -->
<div class="modal fade" id="tambahReturModal" tabindex="-1" aria-labelledby="tambahReturModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <form method="post" action="{% url 'tambah_retur' %}">
                {% csrf_token %}
                <div class="modal-header">
                    <h5 class="modal-title" id="tambahReturModalLabel"><i class="fas fa-plus"></i> Tambah Retur Penjualan</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>

                <div class="modal-body">
                    <div class="mb-3">
                        <label for="{{ formRetur.penjualan.id_for_label }}" class="form-label">{{ formRetur.penjualan.label }}</label>
                        {{ formRetur.penjualan }}
                        {% if formRetur.penjualan.errors %}
                            <div class="text-danger">{{ formRetur.penjualan.errors|striptags }}</div>
                        {% endif %}
                    </div>

                    <div class="mb-3">
                        <label for="{{ formRetur.produk.id_for_label }}" class="form-label">{{ formRetur.produk.label }}</label>
                        {{ formRetur.produk }}
                        {% if formRetur.produk.errors %}
                            <div class="text-danger">{{ formRetur.produk.errors|striptags }}</div>
                        {% endif %}
                    </div>

                    <div class="mb-3">
                        <label for="{{ formRetur.qty.id_for_label }}" class="form-label">{{ formRetur.qty.label }}</label>
                        {{ formRetur.qty }}
                        {% if formRetur.qty.errors %}
                            <div class="text-danger">{{ formRetur.qty.errors|striptags }}</div>
                        {% endif %}
                    </div>

                    <div class="mb-3">
                        <label for="{{ formRetur.alasan.id_for_label }}" class="form-label">{{ formRetur.alasan.label }}</label>
                        {{ formRetur.alasan }}
                        {% if formRetur.alasan.errors %}
                            <div class="text-danger">{{ formRetur.alasan.errors|striptags }}</div>
                        {% endif %}
                    </div>
                </div>

                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Batal</button>
                    <button type="submit" class="btn btn-success">Simpan</button>
                </div>
            </form>
        </div>
    </div>
</div>
<!-- Modal Edit Retur Penjualan -->
<div class="modal fade" id="editReturModal" tabindex="-1" aria-labelledby="editReturModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <form id="formEditRetur" method="post">
                {% csrf_token %}
                <input type="hidden" id="edit_retur_id" name="retur_id">
                
                <div class="modal-header bg-warning text-white">
                    <h5 class="modal-title" id="editReturModalLabel">
                        <i class="fas fa-edit"></i> Edit Retur Penjualan
                    </h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                
                <div class="modal-body">
                    <div class="mb-3">
                        <label for="edit_penjualan" class="form-label">Nomor Penjualan</label>
                        <select class="form-control" id="edit_penjualan" name="penjualan" required>
                            <!-- Opsi penjualan akan diisi dengan JavaScript -->
                        </select>
                        <div class="invalid-feedback" id="error_penjualan"></div>
                    </div>
                    
                    <div class="mb-3">
                        <label for="edit_produk" class="form-label">Produk</label>
                        <select class="form-control" id="edit_produk" name="produk" required>
                            <!-- Opsi produk akan diisi dengan JavaScript -->
                        </select>
                        <div class="invalid-feedback" id="error_produk"></div>
                    </div>
                    
                    <div class="mb-3">
                        <label for="edit_qty" class="form-label">Jumlah Retur</label>
                        <input type="number" class="form-control" id="edit_qty" name="qty" required>
                        <div class="invalid-feedback" id="error_qty"></div>
                    </div>
                    
                    <div class="mb-3">
                        <label for="edit_alasan" class="form-label">Alasan Retur</label>
                        <textarea class="form-control" id="edit_alasan" name="alasan" rows="3"></textarea>
                        <div class="invalid-feedback" id="error_alasan"></div>
                    </div>
                </div>
                
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
                        <i class="fas fa-times"></i> Batal
                    </button>
                    <button type="submit" class="btn btn-warning">
                        <i class="fas fa-save"></i> Simpan Perubahan
                    </button>
                </div>
            </form>
        </div>
    </div>
</div>


<div class="card shadow-sm border-0 mb-4">
    <div class="card-header text-white d-flex justify-content-between align-items-center" style="background-color: rgb(235, 125, 125); background-image: linear-gradient(180deg, rgb(215, 207, 54) 0%,  100%);">
        <h5 class="mb-0"><i class="fas fa-truck"></i> Data Supplier</h5>
    </div>
    <div class="card-body">
        <!-- Button trigger modal -->
        <div class="mb-3">
            <button type="button" class="btn" style="background-color:rgb(235, 125, 125); color: white;" data-bs-toggle="modal" data-bs-target="#tambahSupplierModal">
                <i class="fas fa-plus"></i> Tambah Supplier
            </button>
        </div>

        <!-- Table Supplier -->
        <div class="table-responsive">
            <table id="produkTableSupplier" class="table table-hover table-bordered mb-0">
                <thead style="background-color: rgba(235, 125, 125);" class="text-center">
                    <tr>
                        <th>Nama</th>
                        <th>kontak</th>
                        <th>alamat</th>
                        <th>email</th>
                        <th>aktif</th>
                        <th style="width: 120px;">Aksi</th>
                    </tr>
                </thead>
                <tbody>
                    {% for s in supplier %}
                    <tr>
                        <td>{{ s.nama }}</td>
                        <td>{{ s.kontak }}</td>
                        <td>{{ s.alamat }}</td>
                        <td>{{ s.email }}</td>
                        <td>{{ s.aktif }}</td>
                        <td class="text-center">
                            <button class="btn btn-sm btn-warning edit-supplier-btn" data-id="{{ s.id }}"><i class="fas fa-edit"></i></button>
                            <button class="btn btn-sm btn-danger delete-btn" data-id="{{ s.id }}"><i class="fas fa-trash-alt"></i></button>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
</div>

<div class="card shadow-sm border-0 mb-4">
    <div class="card-header text-white d-flex justify-content-between align-items-center" style="background-color: rgb(235, 125, 125); background-image: linear-gradient(180deg, rgb(215, 207, 54) 0%,  100%);">
        <h5 class="mb-0"><i class="fas fa-warehouse"></i> Data Gudang</h5>
    </div>
    <div class="card-body">
        <!-- Button trigger modal -->
        <div class="mb-3">
            <button type="button" class="btn" style="background-color:rgb(235, 125, 125); color: white;" data-bs-toggle="modal" data-bs-target="#tambahGudangModal">
                <i class="fas fa-plus"></i> Tambah Gudang
            </button>
        </div>

        <!-- Table Gudang -->
        <div class="table-responsive">
            <table id="produkTableGudang" class="table table-hover table-bordered mb-0">
                <thead style="background-color: rgba(235, 125, 125);" class="text-center">
                    <tr>
                        <th>Nama</th>
                        <th>lokasi</th>
                        <th>penanggung_jawab</th>
                        <th>kapasitas</th>
                        <th>aktif</th>
                        <th style="width: 120px;">Aksi</th>
                    </tr>
                </thead>
                <tbody>
                    {% for g in gudang %}
                    <tr>
                        <td>{{ g.nama }}</td>
                        <td>{{ g.lokasi }}</td>
                        <td>{{ g.penanggung_jawab }}</td>
                        <td>{{ g.kapasitas }}</td>
                        <td>{{ g.aktif }}</td>
                        <td class="text-center">
                            <button class="btn btn-sm btn-warning edit-gudang-btn" data-id="{{ g.id }}"><i class="fas fa-edit"></i></button>
                            <button class="btn btn-sm btn-danger delete-gudang-btn" data-id="{{ g.id }}"><i class="fas fa-trash-alt"></i></button>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
</div>

<div class="card shadow-sm border-0 mb-4">
    <div class="card-header text-white d-flex justify-content-between align-items-center" style="background-color: rgb(189, 131, 131); background-image: linear-gradient(180deg, rgb(215, 207, 54) 0%,  100%);">
        <h5 class="mb-0"><i class="fas fa-undo"></i> Data Retur Barang</h5>
    </div>
    <div class="card-body">
        <!-- Button trigger modal -->
        <div class="mb-3">
            <button type="button" class="btn" style="background-color:rgb(189, 131, 131); color: white;" data-bs-toggle="modal" data-bs-target="#tambahReturModal">
                <i class="fas fa-plus"></i> Tambah Retur Barang
            </button>
        </div>

        <!-- Table Supplier -->
        <div class="table-responsive">
            <table id="produkTableRetur" class="table table-hover table-bordered mb-0">
                <thead style="background-color: rgb(189, 131, 131);" class="text-center">
                    <tr>
                        <th>penjualan</th>
                        <th>produk</th>
                        <th>qty</th>
                        <th>tanggal</th>
                        <th>alasan</th>
                        <th style="width: 120px;">Aksi</th>
                    </tr>
                </thead>
                <tbody>
                    {% for rp in retur_penjualan %}
                    <tr>
                        <td>{{ rp.penjualan }}</td>
                        <td>{{ rp.produk }}</td>
                        <td>{{ rp.qty }}</td>
                        <td>{{ rp.tanggal }}</td>
                        <td>{{ rp.alasan }}</td>
                        <td class="text-center">
                            <button class="btn btn-sm btn-warning edit-retur-btn" data-id="{{ rp.id }}"><i class="fas fa-edit"></i></button>
                            <button class="btn btn-sm btn-danger delete-retur-btn" data-id="{{ rp.id }}"><i class="fas fa-trash-alt"></i></button>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
</div>

{% endblock %}

{% block extra_js %}
<script src="{% static 'js/supplier.js' %}"></script>
<script>
    $(document).ready(function () {
        $('#produkTableSupplier').DataTable({
            layout: {
        topStart: {
            buttons: ['excel', 'pdf']
        }
    },
    language: {
        emptyTable: 'Belum ada data produk'
    },
    lengthChange: false
    });

        $('#produkTableGudang').DataTable({
            layout: {
        topStart: {
            buttons: ['excel', 'pdf']
        }
    },
    language: {
        emptyTable: 'Belum ada data produk'
    },
    lengthChange: false
    });

        $('#produkTableRetur').DataTable({
            layout: {
        topStart: {
            buttons: ['excel', 'pdf']
        }
    },
    language: {
        emptyTable: 'Belum ada data produk'
    },
    lengthChange: false
    });
    });

</script>
<script>
    $(document).ready(function() {
        // Handler untuk tombol edit supplier
        $('.edit-supplier-btn').click(function() {
            var supplierId = $(this).data('id');
            
            // AJAX untuk mengambil data supplier
            $.ajax({    
                url: '/supplier/edit-supplier/' + supplierId + '/',  // Sesuaikan URL
                method: 'GET',
                dataType: 'json',
                success: function(data) {
                    // Isi form dengan data supplier
                    $('#edit_supplier_id').val(supplierId);
                    $('#edit_nama').val(data.nama);
                    $('#edit_kontak').val(data.kontak);
                    $('#edit_alamat').val(data.alamat);
                    $('#edit_email').val(data.email);
                    $('#edit_aktif').prop('checked', data.aktif);
                    
                    // Reset error messages
                    $('.invalid-feedback').text('');
                    $('.form-control').removeClass('is-invalid');
                    
                    // Tampilkan modal
                    $('#editSupplierModal').modal('show');
                },
                error: function(xhr, status, error) {
                    console.error("Error:", error);
                    alert('Gagal memuat data supplier');
                }
            });
        });

        // Handler untuk submit form edit supplier
        $('#formEditSupplier').submit(function(e) {
            e.preventDefault();
            var formData = $(this).serialize();
            var supplierId = $('#edit_supplier_id').val();
            
            $.ajax({
                url: '/supplier/edit-supplier/' + supplierId + '/',  // Sesuaikan URL
                method: 'POST',
                data: formData,
                dataType: 'json',
                success: function(response) {
                    if (response.success) {
                        // Tutup modal dan refresh halaman
                        $('#editSupplierModal').modal('hide');
                        window.location.reload();
                    } else {
                        // Tampilkan error messages
                        $.each(response.errors, function(field, messages) {
                            $('#edit_' + field).addClass('is-invalid');
                            $('#error_' + field).text(messages.join(', '));
                        });
                    }
                },
                error: function(xhr, status, error) {
                    console.error("Error:", error);
                    alert('Terjadi kesalahan saat menyimpan perubahan');
                }
            });
        });
        $('.delete-btn').on('click', function () {
            const supplierID = $(this).data('id');
            const deleteUrl = `/supplier/hapus/${supplierID}/`; // Sesuaikan URL ini dengan view hapus Anda
            Swal.fire({
                title: 'Apakah Anda yakin?',
                text: "Anda tidak dapat mengembalikan ini!",
                icon: 'warning',
                showCancelButton: true,
                confirmButtonColor: '#d33',
                cancelButtonColor: '#3085d6',
                confirmButtonText: 'Hapus!',
                cancelButtonText: 'Batal'
            }).then((result) => {
                if (result.isConfirmed) {
                    // Send AJAX request to delete the satuan
                    $.ajax({
                        url: deleteUrl,
                        type: 'POST',
                        data: {
                            'csrfmiddlewaretoken': '{{ csrf_token }}'  // Include CSRF token
                        },
                        success: function (response) {
                            if (response.success) {
                                Swal.fire(
                                    'Dihapus!',
                                    'Satuan telah dihapus.',
                                    'success'
                                ).then(() => {
                                    location.reload(); // Reload the page to see changes
                                });
                            } else {
                                Swal.fire(
                                    'Gagal!',
                                    response.message,  // Tampilkan pesan kesalahan jika ada
                                    'error'
                                );
                            }
                        },
                        error: function () {
                            Swal.fire(
                                'Gagal!',
                                'Terjadi kesalahan saat menghapus satuan.',
                                'error'
                            );
                        }
                    });
                }
            });
        });
    });
</script>
<script>
    $(document).ready(function() {
        // Handler untuk tombol edit gudang
        $('.edit-gudang-btn').click(function() {
            var gudangId = $(this).data('id');
            
            // AJAX untuk mengambil data gudang
            $.ajax({    
                url: '/supplier/edit-gudang/' + gudangId + '/',  // Sesuaikan URL
                method: 'GET',
                dataType: 'json',
                success: function(data) {
                    // Isi form dengan data gudang
                    $('#edit_gudang_id').val(gudangId);
                    $('#edit_nama').val(data.nama);
                    $('#edit_lokasi').val(data.lokasi);
                    $('#edit_penanggung_jawab').val(data.penanggung_jawab);
                    $('#edit_kapasitas').val(data.kapasitas);
                    $('#edit_aktif').prop('checked', data.aktif);
                    
                    // Reset error messages
                    $('.invalid-feedback').text('');
                    $('.form-control').removeClass('is-invalid');
                    
                    // Tampilkan modal
                    $('#editGudangModal').modal('show');
                },
                error: function(xhr, status, error) {
                    console.error("Error:", error);
                    alert('Gagal memuat data gudang');
                }
            });
        });
        // Handler untuk submit form edit gudang
        $('#formEditGudang').submit(function(e) {
            e.preventDefault();
            var formData = $(this).serialize();
            var gudangId = $('#edit_gudang_id').val();
            
            $.ajax({
                url: '/supplier/edit-gudang/' + gudangId + '/',  // Sesuaikan URL
                method: 'POST',
                data: formData,
                dataType: 'json',
                success: function(response) {
                    if (response.success) {
                        // Tutup modal dan refresh halaman
                        $('#editGudangModal').modal('hide');
                        window.location.reload();
                    } else {
                        // Tampilkan error messages
                        $.each(response.errors, function(field, messages) {
                            $('#edit_' + field).addClass('is-invalid');
                            $('#error_' + field).text(messages.join(', '));
                        });
                    }
                },
                error: function(xhr, status, error) {
                    console.error("Error:", error);
                    alert('Terjadi kesalahan saat menyimpan perubahan');
                }
            });
        });
        $('.delete-gudang-btn').on('click', function () {
            const gudangID = $(this).data('id');
            const deleteUrl = `/supplier/hapus-gudang/${gudangID}/`; // Sesuaikan URL ini dengan view hapus Anda
            Swal.fire({
                title: 'Apakah Anda yakin?',
                text: "Anda tidak dapat mengembalikan ini!",
                icon: 'warning',
                showCancelButton: true,
                confirmButtonColor: '#d33',
                cancelButtonColor: '#3085d6',
                confirmButtonText: 'Hapus!',
                cancelButtonText: 'Batal'
            }).then((result) => {
                if (result.isConfirmed) {
                    // Send AJAX request to delete the satuan
                    $.ajax({
                        url: deleteUrl,
                        type: 'POST',
                        data: {
                            'csrfmiddlewaretoken': '{{ csrf_token }}'  // Include CSRF token
                        },
                        success: function (response) {
                            if (response.success) {
                                Swal.fire(
                                    'Dihapus!',
                                    'Satuan telah dihapus.',
                                    'success'
                                ).then(() => {
                                    location.reload(); // Reload the page to see changes
                                });
                            } else {
                                Swal.fire(
                                    'Gagal!',
                                    response.message,  // Tampilkan pesan kesalahan jika ada
                                    'error'
                                );
                            }
                        },
                        error: function () {
                            Swal.fire(
                                'Gagal!',
                                'Terjadi kesalahan saat menghapus satuan.',
                                'error'
                            );
                        }
                    });
                }
            });
        });
    });
</script>
<script>
    $(document).ready(function() {
        // Handler untuk tombol edit retur
        $('.edit-retur-btn').click(function() {
            var returId = $(this).data('id');
            
            // AJAX untuk mengambil data retur
            $.ajax({    
                url: '/supplier/edit-retur/' + returId + '/',  // Sesuaikan URL
                method: 'GET',
                dataType: 'json',
                success: function(data) {
                    // Isi form dengan data retur
                    $('#edit_retur_id').val(returId);
                    $('#edit_penjualan').val(data.penjualan);  // Mengisi ID penjualan
                    $('#edit_produk').val(data.produk);        // Mengisi ID produk
                    $('#edit_qty').val(data.qty);
                    $('#edit_alasan').val(data.alasan);
                    
                    // Reset error messages
                    $('.invalid-feedback').text('');
                    $('.form-control').removeClass('is-invalid');
                    
                    // Tampilkan modal
                    $('#editReturModal').modal('show');
                },
                error: function(xhr, status, error) {
                    console.error("Error:", error);
                    alert('Gagal memuat data retur');
                }
            });
        });

        // Handler untuk submit form edit retur
        $('#formEditRetur').submit(function(e) {
            e.preventDefault();
            var formData = $(this).serialize();
            var returId = $('#edit_retur_id').val();
            
            $.ajax({
                url: '/supplier/edit-retur/' + returId + '/',  // Sesuaikan URL
                method: 'POST',
                data: formData,
                dataType: 'json',
                success: function(response) {
                    if (response.success) {
                        // Tutup modal dan refresh halaman
                        $('#editReturModal').modal('hide');
                        window.location.reload();
                    } else {
                        // Tampilkan error messages
                        $.each(response.errors, function(field, messages) {
                            $('#edit_' + field).addClass('is-invalid');
                            $('#error_' + field).text(messages.join(', '));
                        });
                    }
                },
                error: function(xhr, status, error) {
                    console.error("Error:", error);
                    alert('Terjadi kesalahan saat menyimpan perubahan');
                }
            });
        });
        $('.delete-retur-btn').on('click', function () {
            const returID = $(this).data('id');
            const deleteUrl = `/supplier/hapus-retur/${returID}/`; // Sesuaikan URL ini dengan view hapus Anda
            Swal.fire({
                title: 'Apakah Anda yakin?',
                text: "Anda tidak dapat mengembalikan ini!",
                icon: 'warning',
                showCancelButton: true,
                confirmButtonColor: '#d33',
                cancelButtonColor: '#3085d6',
                confirmButtonText: 'Hapus!',
                cancelButtonText: 'Batal'
            }).then((result) => {
                if (result.isConfirmed) {
                    // Send AJAX request to delete the satuan
                    $.ajax({
                        url: deleteUrl,
                        type: 'POST',
                        data: {
                            'csrfmiddlewaretoken': '{{ csrf_token }}'  // Include CSRF token
                        },
                        success: function (response) {
                            if (response.success) {
                                Swal.fire(
                                    'Dihapus!',
                                    'Satuan telah dihapus.',
                                    'success'
                                ).then(() => {
                                    location.reload(); // Reload the page to see changes
                                });
                            } else {
                                Swal.fire(
                                    'Gagal!',
                                    response.message,  // Tampilkan pesan kesalahan jika ada
                                    'error'
                                );
                            }
                        },
                        error: function () {
                            Swal.fire(
                                'Gagal!',
                                'Terjadi kesalahan saat menghapus satuan.',
                                'error'
                            );
                        }
                    });
                }
            });
        });
    });
</script>


{% endblock %}
